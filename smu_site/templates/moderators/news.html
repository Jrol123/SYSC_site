{% extends 'base.html' %}
{% load static %}

{% block title %}Responsive Animated Navbar{% endblock %}
{% block meta %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="keywords" content="">
    <meta name="description" content="">
{% endblock %}
<!-- IconFont and Stylesheet -->
{% block link %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" integrity="sha512-siarrzI1u3pCqFG2LEzi87McrBmq6Tp7juVsdmGY1Dr8Saw+ZBAzDzrGwX3vgxX1NkioYNCFOVC0GpDPss10zQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
	<script src="https://cdn.tiny.cloud/1/x9fbifsbf9wgj1k6nbzyfyhabvwcsb9ewleh0lajmfbfnvip/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
	<style>
		.tox-collection__item-icon  svg {
			color:black !important;
		}
		.tox-icon svg {
			color:black !important;
		}
	</style>
	<script type="text/javascript">
		tinymce.init({
			selector: '#myTextarea',
			
			plugins: [
			'advlist', 'autolink', 'link', 'image', 'lists', 'charmap', 'preview', 'anchor', 'pagebreak',
			'searchreplace', 'wordcount', 'visualblocks', 'visualchars', 'code', 'fullscreen', 'insertdatetime',
			'media', 'table', 'emoticons', 'template'
			],
			toolbar: 'undo redo | styles | bold italic | alignleft aligncenter alignright alignjustify | ' +
			'bullist numlist outdent indent | link image | print preview media fullscreen | ' +
			'forecolor backcolor emoticons | help | googlemap',
	
			setup: function (editor) {
			  editor.ui.registry.addButton('googlemap', {
				text: 'Insert Map',
				onAction: function () {
				  let link = prompt("Enter the link here.");
				  
				  if(link != ""){
					const mapCode = '<iframe src="' + link + '" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe>';
					editor.insertContent(mapCode);
				  }
				},
			  });
			},
            /* Block popup (DO NOT REMOVE COMMENTS)
			init_instance_callback : function(editor) {
				var freeTiny = document.querySelector('.tox .tox-notification--in');
			   freeTiny.style.display = 'none';
			  },*/
			menu: {
			favs: { title: 'My Favorites', items: 'code visualaid | searchreplace | emoticons' }
			},
			menubar: 'favs file edit view insert format tools table help',
           

            image_title: true,
            // enable automatic uploads of images represented by blob or data URIs
            automatic_uploads: true,
            // add custom filepicker only to Image dialog
            file_picker_types: 'image',
            file_picker_callback: function(cb, value, meta) {
                var input = document.createElement('input');
                input.setAttribute('type', 'file');
                input.setAttribute('accept', 'image/*');

                input.onchange = function() {
                    var file = this.files[0];
                    var reader = new FileReader();

                    reader.onload = function () {
                        var id = 'blobid' + (new Date()).getTime();
                        var blobCache =  tinymce.activeEditor.editorUpload.blobCache;
                        var base64 = reader.result.split(',')[1];
                        var blobInfo = blobCache.create(id, file, base64);
                        blobCache.add(blobInfo);

                        // call the callback and populate the Title field with the file name
                        cb(blobInfo.blobUri(), { title: file.name });
                    };
                    reader.readAsDataURL(file);
                };

                input.click();
            }
        });
		</script>

		<script>
			function call() {
			  var content =tinymce.get("myTextarea").getContent();
			  var blob = new Blob([content], { type: "text/plain" });
		
			  var a = document.createElement("a");
			  a.href = URL.createObjectURL(blob);
			  a.download = "output.txt";
			  document.body.appendChild(a);
			  a.click();
			  document.body.removeChild(a);
			}
		  </script>
		  
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script>
		$(document).ready(function() {
			$('.for_event').hide();
				// Show/hide institute-related elements based on user group selection
				$('#NewEvents').change(function() {
					  if ($(this).val() === 'News') {
						$('.for_event').hide();
					  } else {
						$('.for_event').show();
					  }
				});
			});
		</script>
{% endblock %}
<!--//-->



{% block content %}
	<div class="z-index:3">
        {% include "navbar.html" %}
        {% include "moderators/moder_navbar.html" %}
    </div>

    
	<div class="place_form main_plate plates_home container-custom plate-container">
		{% csrf_token %}
		<div class="decorate_form plates col-lg-12 col-sm-12 col-md-12 col-xs-12" >
			<div style="position:relative; z-index:1" class="labels_for_form container-custom">
				<div class="pt-4 col-lg-12 col-md-12 col-sm-12">
					<textarea id="myTextarea" style="width:100%"></textarea>
				</div> 

                <div class="container-custom">
                        <label class="labels_for_form" for="files"> Прикрепление основного изображения: </label>
                        <input class="input_for_form_img" type="file" id="imageInput" name="image" accept=".jpg, .jpeg, .png">
                        <input class="labels_for_form mt-1 mb-1 plates col-lg-5 col-sm-5 col-md-5 col-xs-5 btn" type="button" onclick="call()" value="Показать сгенерированный HRML-код">
                        <input class="submit_all labels_for_form plates mb-3  col-lg-2 col-sm-2 col-md-2 col-xs-2" type="submit" onclick="save()" value="Опубликовать">
                    <script>
                      function save() {
                        var content = tinymce.get('myTextarea').getContent();
                        var titleElement = document.getElementById('myTitle');
                        var imageInput = document.getElementById('imageInput');
                        var data = new FormData();
                          data.append('text', content);
                          data.append('title', titleElement.value);
                          data.append('image', imageInput.files[0]);
			<div class="container-custom">
				<form class="form_all" action="" method="POST">
					{% csrf_token %}
					<input type="text" class="form-control mt-2 labels_for_form platesx" style="height:4em; margin-bottom:1em" placeholder="Название новости" required/>
					<label class="labels_for_form" for="files"> Прикрепление основного изображения: </label>
					<input class="input_for_form_img" type="file" id="imageInput" name="image" accept=".jpg, .jpeg, .png">
					<input class="labels_for_form mt-1 mb-1 plates col-lg-5 col-sm-5 col-md-5 col-xs-5 btn" type="button" onclick="call()" value="Показать сгенерированный HRML-код">
					<label  class="mt-2 labels_for_form inst" for="institute">Категория публикации</label>
					<select class="form-control input_for_form text-dark" id="NewEvents" name="NewEvents">
						<option value="News">Новость</option>
						<option value="Num_2">Событие</option>
					</select>
					<div class="for_event">
						<label class="labels_for_form" for="startDate">Дата начала события:</label>
						<input class="input_for_form"type="datetime-local" id="startDate" name="startDate">
						<label class="labels_for_form" for="endDate">Дата окончания события:</label>
						<input class="input_for_form"type="datetime-local" id="endDate" name="endDate">
					</div>
					<input class="submit_all labels_for_form plates mt-3 mb-3  col-lg-2 col-sm-2 col-md-2 col-xs-2" type="submit" value="Опубликовать">
				</form>
			</div>
		</div>
	</div>
    {% include "footer.html" %}

 
{% endblock %}
